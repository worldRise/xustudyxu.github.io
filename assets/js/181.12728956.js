(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{664:function(a,s,t){"use strict";t.r(s);var e=t(17),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"redis-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-配置文件"}},[a._v("#")]),a._v(" Redis 配置文件")]),a._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#位置"}},[a._v("位置")])]),t("li",[t("a",{attrs:{href:"#单位"}},[a._v("单位")])]),t("li",[t("a",{attrs:{href:"#include"}},[a._v("include")])]),t("li",[t("a",{attrs:{href:"#network网络配置"}},[a._v("NETWORK网络配置")]),t("ul",[t("li",[t("a",{attrs:{href:"#bind、protected-mode、port"}},[a._v("bind、protected-mode、Port")])]),t("li",[t("a",{attrs:{href:"#tcp-backlog"}},[a._v("tcp-backlog")])]),t("li",[t("a",{attrs:{href:"#timeout"}},[a._v("timeout")])]),t("li",[t("a",{attrs:{href:"#tcp-keepalive"}},[a._v("tcp-keepalive")])])])]),t("li",[t("a",{attrs:{href:"#general通用"}},[a._v("GENERAL通用")]),t("ul",[t("li",[t("a",{attrs:{href:"#daemonize"}},[a._v("daemonize")])]),t("li",[t("a",{attrs:{href:"#pidfile"}},[a._v("pidfile")])]),t("li",[t("a",{attrs:{href:"#loglevel"}},[a._v("loglevel")])]),t("li",[t("a",{attrs:{href:"#logfile"}},[a._v("logfile")])]),t("li",[t("a",{attrs:{href:"#databases"}},[a._v("databases")])])])]),t("li",[t("a",{attrs:{href:"#snapshopting持久化"}},[a._v("SNAPSHOPTING持久化")])]),t("li",[t("a",{attrs:{href:"#replication主从复制"}},[a._v("REPLICATION主从复制")])]),t("li",[t("a",{attrs:{href:"#security安全"}},[a._v("SECURITY安全")])]),t("li",[t("a",{attrs:{href:"#客户端连接相关"}},[a._v("客户端连接相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#maxclients"}},[a._v("maxclients")])]),t("li",[t("a",{attrs:{href:"#maxmemory"}},[a._v("maxmemory")])]),t("li",[t("a",{attrs:{href:"#maxmemory-policy"}},[a._v("maxmemory-policy")])]),t("li",[t("a",{attrs:{href:"#maxmemory-samples"}},[a._v("maxmemory-samples")])])])]),t("li",[t("a",{attrs:{href:"#append-only模式"}},[a._v("append only模式")])])])]),t("p"),a._v(" "),t("h2",{attrs:{id:"位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#位置"}},[a._v("#")]),a._v(" 位置")]),a._v(" "),t("p",[a._v("Redis 的配置文件位于 Redis 安装目录下，文件名为 redis.conf。")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("config get * "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获取全部的配置")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("我们一般情况下，会单独拷贝出来一份进行操作。来保证初始文件的安全。")]),a._v(" "),t("p",[a._v("正如在 "),t("code",[a._v("安装 redis")]),a._v(" 中的讲解中拷贝一份。")]),a._v(" "),t("p",[a._v("我的配置文件放在了/etc/redis.conf")]),a._v(" "),t("h2",{attrs:{id:"单位"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单位"}},[a._v("#")]),a._v(" 单位")]),a._v(" "),t("p",[a._v("容量单位不区分大小写，但是容量大小 G 和 GB 有区别。")]),a._v(" "),t("p",[a._v("配置大小单位，开头定义了一些基本的度量单位，"),t("code",[a._v("只支持 bytes")]),a._v("，不支持 bit")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.2wldm940hu40.webp",loading:"lazy"}})]),a._v(" "),t("h2",{attrs:{id:"include"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#include"}},[a._v("#")]),a._v(" include")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.62lr2dieq8g0.webp",loading:"lazy"}})]),a._v(" "),t("p",[a._v("类似 jsp 中的 include，可以通过 includes 包含，redis.conf 可以作为总文件，可以包含其他文件，即"),t("strong",[a._v("多实例的情况可以把公用的配置文件提取出来")]),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"network网络配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#network网络配置"}},[a._v("#")]),a._v(" NETWORK网络配置")]),a._v(" "),t("h3",{attrs:{id:"bind、protected-mode、port"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bind、protected-mode、port"}},[a._v("#")]),a._v(" bind、protected-mode、Port")]),a._v(" "),t("p",[a._v("默认情况 "),t("code",[a._v("bind=127.0.0.1")]),a._v(" 只能接受本机的访问请求，如果注释掉或不写的情况下，无限制接受任何 ip 地址的访问。")]),a._v(" "),t("p",[a._v("生产环境肯定要写你应用服务器的地址，服务器是需要远程访问的，所以需要将其注释掉。")]),a._v(" "),t("p",[a._v("如果开启了 "),t("code",[a._v("protected-mode")]),a._v("，那么在没有设定 bind ip 且没有设密码的情况下，Redis 只允许接受本机的响应。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.dj0oyoiz5lc.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"tcp-backlog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-backlog"}},[a._v("#")]),a._v(" tcp-backlog")]),a._v(" "),t("p",[a._v("设置 tcp 的 backlog。backlog 其实是一个连接队列，backlog 队列总和 = 未完成三次握手队列 + 已经完成三次握手队列。")]),a._v(" "),t("p",[a._v("在高并发环境下你需要一个高 backlog 值来避免慢客户端连接问题。")]),a._v(" "),t("p",[a._v("注意 Linux 内核会将这个值减小到 "),t("code",[a._v("/proc/sys/net/core/somaxconn")]),a._v(" 的值（128），所以需要确认增大 "),t("code",[a._v("/proc/sys/net/core/somaxconn")]),a._v(" 和 "),t("code",[a._v("/proc/sys/net/ipv4/tcp_max_syn_backlog（128）")]),a._v(" 两个值来达到想要的效果。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.12g81csqei5c.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"timeout"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#timeout"}},[a._v("#")]),a._v(" timeout")]),a._v(" "),t("p",[a._v("一个空闲的客户端维持多少秒会关闭，0 表示关闭该功能。即永不关闭。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.6glvy8su6hk0.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"tcp-keepalive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-keepalive"}},[a._v("#")]),a._v(" tcp-keepalive")]),a._v(" "),t("p",[a._v("对访问客户端的一种心跳检测，每个 n 秒检测一次。")]),a._v(" "),t("p",[a._v("单位为秒，如果设置为 0，则不会进行 Keepalive 检测，建议设置成 60。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.6smxk5voaeg0.webp",loading:"lazy"}})]),a._v(" "),t("h2",{attrs:{id:"general通用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#general通用"}},[a._v("#")]),a._v(" GENERAL通用")]),a._v(" "),t("h3",{attrs:{id:"daemonize"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#daemonize"}},[a._v("#")]),a._v(" daemonize")]),a._v(" "),t("p",[a._v("是否为后台进程，设置为 yes 为守护进程，后台启动。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.58cxq6t657g0.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"pidfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pidfile"}},[a._v("#")]),a._v(" pidfile")]),a._v(" "),t("p",[a._v("存放 pid 文件的位置，每个实例会产生一个不同的 pid 文件")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.4r8ts2i60ce.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"loglevel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#loglevel"}},[a._v("#")]),a._v(" loglevel")]),a._v(" "),t("p",[a._v("指定日志记录级别，Redis 总共支持四个级别：debug、verbose、notice、warning，默认为 notice。")]),a._v(" "),t("p",[a._v("四个级别根据使用阶段来选择，生产环境选择 notice 或者 warning。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.5dr7ffokpp40.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"logfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logfile"}},[a._v("#")]),a._v(" logfile")]),a._v(" "),t("p",[a._v("日志文件名称")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.5rxjmoz5t5g0.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"databases"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#databases"}},[a._v("#")]),a._v(" databases")]),a._v(" "),t("p",[a._v("设定库的数量 默认 16，默认数据库为 0，可以使用 "),t("code",[a._v("SELECT <dbid>")]),a._v("命令在连接上指定数据库 id。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.4yhdsttiv8k0.webp",loading:"lazy"}})]),a._v(" "),t("p",[a._v("常用模板如下：")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("daemonize "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" \t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认情况下，Redis 不作为守护进程运行。需要开启的话，改为 yes")]),a._v("\n\nsupervised no \t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可通过 upstart 和 systemd 管理 Redis 守护进程")]),a._v("\n\nloglevel notice \t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 日志级别。可选项有：")]),a._v("\n\t\t\t\t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# debug（记录大量日志信息，适用于开发、测试阶段）")]),a._v("\n\t\t\t\t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# verbose（较多日志信息）")]),a._v("\n\t\t\t\t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# notice（适量日志信息，使用于生产环境）")]),a._v("\n\t\t\t\t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# warning（仅有部分重要、关键信息才会被记录）")]),a._v("\nlogfile "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v(" \t\t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 日志文件的位置，当指定为空字符串时，为标准输出")]),a._v("\ndatabases "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("16")]),a._v(" \t\t "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置数据库的数目。默认的数据库是 DB 0")]),a._v("\nalways-show-logo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是否总是显示 logo")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br")])]),t("h2",{attrs:{id:"snapshopting持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#snapshopting持久化"}},[a._v("#")]),a._v(" SNAPSHOPTING持久化")]),a._v(" "),t("p",[a._v("由于 Redis 是基于内存的数据库，需要将数据由内存持久化到文件中。")]),a._v(" "),t("p",[a._v("持久化方式：")]),a._v(" "),t("ul",[t("li",[a._v("RDB")]),a._v(" "),t("li",[a._v("AOF")])]),a._v(" "),t("p",[a._v("AOF 配置：")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 900秒（15分钟）内至少 1 个 key 值改变（则进行数据库保存--持久化）")]),a._v("\nsave "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("900")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 300秒（5分钟）内至少 10 个 key 值改变（则进行数据库保存--持久化）")]),a._v("\nsave "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("300")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 60秒（1分钟）内至少 10000 个 key 值改变（则进行数据库保存--持久化）")]),a._v("\nsave "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10000")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.1240hsnunjls.webp",loading:"lazy"}})]),a._v(" "),t("p",[a._v("RDB 配置：（内容太长，以代码显示）")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("stop-writes-on-bgsave-error "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 持久化出现错误后，是否依然进行继续进行工作")]),a._v("\n\nrdbcompression "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用压缩 rdb 文件 yes：压缩，但是需要一些 cpu 的消耗。no：不压缩，需要更多的磁盘空间")]),a._v("\n\nrdbchecksum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是否校验 rdb 文件，更有利于文件的容错性，但是在保存 rdb 文件的时候，会有大概 10% 的性能损耗")]),a._v("\n\ndbfilename dump.rdb "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dbfilenamerdb 文件名称")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dir")]),a._v(" ./ \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dir 数据目录，数据库的写入会在这个目录。rdb、aof 文件也会写在这个目录")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("h2",{attrs:{id:"replication主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#replication主从复制"}},[a._v("#")]),a._v(" REPLICATION主从复制")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.292e2mnfuyv4.webp",loading:"lazy"}})]),a._v(" "),t("p",[a._v("简单认识，后面详细说。")]),a._v(" "),t("h2",{attrs:{id:"security安全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#security安全"}},[a._v("#")]),a._v(" SECURITY安全")]),a._v(" "),t("p",[a._v("命令访问密码的查看，设置和取消，缺点：在命令中设置密码，只是临时的。重启 redis 服务器，密码就还原了。")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动redis")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 连接客户端")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获得和设置密码")]),a._v("\nconfig get requirepass\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" requirepass "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"123456"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#测试ping，发现需要验证")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("9")]),a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ping")]),a._v("\nNOAUTH Authentication required.\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 验证")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("9")]),a._v(">")]),a._v(" auth "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("9")]),a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ping")]),a._v("\nPONG\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br")])]),t("p",[a._v("或者在配置文件修改密码")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("requirepass "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"123456"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.4f1aycqioec0.webp",loading:"lazy"}})]),a._v(" "),t("h2",{attrs:{id:"客户端连接相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端连接相关"}},[a._v("#")]),a._v(" 客户端连接相关")]),a._v(" "),t("h3",{attrs:{id:"maxclients"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maxclients"}},[a._v("#")]),a._v(" maxclients")]),a._v(" "),t("p",[a._v("设置 redis 同时可以与多少个客户端进行连接。")]),a._v(" "),t("p",[a._v("默认情况下为 10000 个客户端，如果达到了此限制，redis 则会拒绝新的连接请求，并且向这些连接请求方发出 "),t("code",[a._v("max number of clients reached")]),a._v(" 以作回应。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.65bq1oeq7t80.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"maxmemory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maxmemory"}},[a._v("#")]),a._v(" maxmemory")]),a._v(" "),t("p",[a._v("建议必须设置，否则，将内存占满，造成服务器宕机，设置 redis 可以使用的内存量。一旦到达内存使用上限，redis 将会试图移除内部数据，移除规则可以通过 maxmemory-policy 来指定。")]),a._v(" "),t("p",[a._v("如果 redis 无法根据移除规则来移除内存中的数据，或者设置了「不允许移除」， 那么 redis 则会针对那些需要申请内存的指令返回错误信息，比如 SET、LPUSH 等。")]),a._v(" "),t("p",[a._v("但是对于无内存申请的指令，仍然会正常响应，比如 GET 等。如果你的 redis 是主 redis（说明你的 redis 有从 redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是「不移除」的情况下，才不用考虑这个因素。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.18vbghy9nohs.webp",loading:"lazy"}})]),a._v(" "),t("h3",{attrs:{id:"maxmemory-policy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maxmemory-policy"}},[a._v("#")]),a._v(" maxmemory-policy")]),a._v(" "),t("p",[t("code",[a._v("maxmemory-policy")]),a._v(" 六种方式：")]),a._v(" "),t("ul",[t("li",[a._v("volatile-lru：利用 LRU 算法移除设置过过期时间的 key")]),a._v(" "),t("li",[a._v("allkeys-lru： 用 lru 算法删除 key")]),a._v(" "),t("li",[a._v("volatile-random：随机删除即将过期 key")]),a._v(" "),t("li",[a._v("allkeys-random：随机删除")]),a._v(" "),t("li",[a._v("volatile-ttl：删除即将过期的")]),a._v(" "),t("li",[a._v("noevictionx：不移除任何 key，只是返回一个写错误")])]),a._v(" "),t("p",[a._v("redis 中的 "),t("strong",[a._v("默认")]),a._v(" 的过期策略是 "),t("code",[a._v("volatile-lru")]),a._v("。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.61m0c6j7l6g0.webp",loading:"lazy"}})]),a._v(" "),t("p",[a._v("命令设置方式")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" maxmemory-policy volatile-lru \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("配置文件设置")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("maxclients "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10000")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 最大客户端数量")]),a._v("\nmaxmemory "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 最大内存限制")]),a._v("\nmaxmemory-policy noeviction "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 内存达到限制值的处理策略")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h3",{attrs:{id:"maxmemory-samples"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maxmemory-samples"}},[a._v("#")]),a._v(" maxmemory-samples")]),a._v(" "),t("p",[a._v("设置样本数量，LRU 算法和最小 TTL 算法都并非是精确的算法，而是估算值，所以你可以设置样本的大小，redis 默认会检查这么多个 key 并选择其中 LRU 的那个。")]),a._v(" "),t("p",[a._v("一般设置 3 到 7 的数字，数值越小样本越不准确，但性能消耗越小。")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.4k9gvtjhemm0.webp",loading:"lazy"}})]),a._v(" "),t("h2",{attrs:{id:"append-only模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#append-only模式"}},[a._v("#")]),a._v(" append only模式")]),a._v(" "),t("p",[a._v("AOF 相关部分")]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.1n579oynzb28.webp",loading:"lazy"}})]),a._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cdn.staticaly.com/gh/xustudyxu/image-hosting@master/image.4b9868dsuv20.webp",loading:"lazy"}})]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("appendfsync everysec \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# appendfsync aof 持久化策略的配置")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# no 表示不执行 fsync，由操作系统保证数据同步到磁盘，速度最快。")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# always表示每次写入都执行 fsync，以保证数据同步到磁盘。")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# everysec表示每秒执行一次 fsync，可能会导致丢失这 1s数据。")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);